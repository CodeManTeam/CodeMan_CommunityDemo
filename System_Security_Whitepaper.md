# CodeMan Community 系统安全性白皮书

本文档详细介绍了 CodeMan Community 系统在安全性设计、数据保护及隐私合规方面的技术实现与策略。

## 1. 核心安全架构

### 1.1 认证与授权 (Authentication & Authorization)
*   **非对称加密登录**: 采用 **RSA-2048** 算法保护用户密码传输。前端使用公钥加密，后端使用私钥解密，确保密码在网络传输过程中（即使是 HTTPS）不被中间人攻击窃取明文。
*   **Token 机制**: 使用 **JWT (JSON Web Token)** 进行无状态会话管理。Token 包含用户身份标识和过期时间，防止会话劫持和重放攻击。
*   **统一认证集成**: 系统不直接存储用户原始密码，而是通过编程猫官方 API 进行验证，仅在本地存储加密后的凭证副本和 Token，最大程度降低数据泄露风险。

### 1.2 数据安全 (Data Security)
*   **密钥管理**: RSA 私钥 (`private_key.pem`) 存储在服务器受保护的目录中，严禁通过代码仓库或公开网络传输。
*   **数据隔离**: 数据库文件 (`database.db`) 位于受控的 Docker 容器卷中，外部无法直接访问。
*   **敏感信息加密**: 存储在数据库中的敏感字段（如 OAuth 凭证）经过二次加密处理。

## 2. 应用层防护 (Application Security)

### 2.1 防爬虫与反自动化 (Anti-Scraping)
*   **中间件拦截**: 自研 `anti_scraping_middleware` 中间件，对所有请求进行实时分析。
*   **User-Agent 过滤**: 自动识别并拦截已知的恶意爬虫、扫描器和自动化脚本 (`BLOCKED_USER_AGENTS`)。
*   **Referer/Origin 校验**: 严格检查 POST/PUT/DELETE 等写操作请求的来源，防止 CSRF (跨站请求伪造) 攻击。

### 2.2 接口防护 (API Protection)
*   **速率限制 (Rate Limiting)**: 集成 `SlowAPI`，基于 IP 地址对关键接口实施限流：
    *   **登录接口**: 5次/分钟（防暴力破解）
    *   **发帖/评论**: 10次/分钟（防灌水）
    *   **全局读取**: 60次/分钟（防数据采集）
*   **输入验证**: 使用 Pydantic 模型对所有 API 输入参数进行严格的类型和格式校验，拒绝非法数据。

### 2.3 内容安全 (Content Security)
*   **XSS 防护**: 
    *   集成 `Bleach` 和 `nh3` 库，对所有用户提交的 HTML/Markdown 内容进行清洗。
    *   白名单机制：仅允许 `<b>`, `<i>`, `<img>` 等安全标签，自动移除 `<script>`, `<iframe>`, `onclick` 等危险代码。
*   **SQL 注入防护**: 使用 ORM (Peewee) 进行数据库操作，自动转义参数，杜绝 SQL 注入漏洞。

## 3. 网络与部署安全 (Network & Infrastructure)

### 3.1 容器化隔离
*   **Docker 封装**: 前端和后端服务运行在独立的 Docker 容器中，互不干扰，且与宿主机环境隔离。
*   **最小权限原则**: 容器仅开放必要的 80 (Web) 和 8000 (API) 端口，其他端口对外关闭。

### 3.2 流量控制
*   **Nginx 反向代理**: 前端 Nginx 充当流量网关，提供静态资源缓存和第一层流量过滤。
*   **端口管理**: 宿主机仅暴露标准 Web 端口，数据库端口不对外开放，防止远程连接攻击。

## 4. 隐私保护 (Privacy)

*   **数据最小化**: 仅采集必要的公开用户信息（昵称、头像、简介），不收集手机号、真实姓名等敏感个人隐私。
*   **透明度**: 提供清晰的 "About Us" 和授权页面，明确告知用户数据使用目的和范围。
*   **Cookie 安全**: 关键 Cookie（如浏览记录）设置合理的过期时间，且仅用于改善用户体验（如防止重复计数）。

---
*CodeMan Community 安全团队*
*文档版本: 1.0 (2026-02-24)*
