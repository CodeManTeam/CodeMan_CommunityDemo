
import { reactive, computed, watch } from 'vue'

const savedLang = localStorage.getItem('app_lang') || 'zh'

export const i18nState = reactive({
  locale: savedLang
})

export function setLocale(lang) {
  i18nState.locale = lang
  localStorage.setItem('app_lang', lang)
}

const messages = {
  zh: {
    common: {
      home: '首页',
      forum: '论坛',
      showcase: '作品展示',
      about: '关于我们',
      login: '登录',
      logout: '退出登录',
      profile: '个人主页',
      loading: '加载中...',
      loadMore: '加载更多',
      noMore: '已经到底啦~',
      views: '浏览',
      likes: '点赞',
      download: '下载',
      post: '帖子',
      joinDiscussion: '加入讨论',
      exploreProjects: '探索项目',
      welcome: '欢迎来到 CodeMan',
      welcomeDesc: '新一代创意编程社区。安全、快速、开放。',
      trending: '热门趋势',
      hotDiscuss: '热门讨论',
      hotWorks: '热门作品',
      recentDiscuss: '最新讨论',
      viewForum: '查看论坛',
      featuredWorks: '精选作品',
      viewShowcase: '查看展示',
      noDiscussions: '暂无讨论，快来发布第一条吧！',
      slogan: '连接每位开发者',
      mission: '缔造更好猫站，为编程猫用户打造的安全、自由、开放的交流社区。',
      featureSource: '特色源码分享',
      featureSourceDesc: '汇聚优质编程猫作品源码，促进技术交流与学习，让知识自由流动。',
      featureSafe: '安全浏览体验',
      featureSafeDesc: '内置防 XSS 攻击机制，过滤恶意代码，为所有年龄段用户提供纯净的浏览环境。',
      featureApi: '开放 API 接口',
      featureApiDesc: '面向全体编程猫用户提供安全、稳定的 API 接口，赋能开发者创造更多可能。',
      team: '维护团队',
      maintainer: 'CodeMan Community 由 Skyworld 全权维护。',
      devService: '开发者服务',
      devServiceDesc: '我们提供编程猫统一登录平台接入方案，支持 iframe + SDK 快速集成。',
      ack: '特别致谢',
      loginTitle: '账号登录',
      loginSubtitle: '请使用编程猫社区账号继续',
      usernameLabel: '账号 / 手机号',
      passwordLabel: '密码',
      usernamePlaceholder: '请输入编程猫账号',
      passwordPlaceholder: '请输入密码',
      submitLogin: '授权并登录',
      loggingIn: '正在验证...',
      forgotPassword: '忘记密码? 请前往编程猫官网找回',
      authTitle: '开发者授权',
      authRequest: 'CodeMan Community 请求访问您的账户信息。',
      authScope: '此操作将允许该应用获取您的公开资料（昵称、头像、简介等）。',
      scopeProfile: '读取用户公开资料',
      scopePost: '发布帖子与评论',
      sessionExpired: '会话已过期',
      sessionExpiredDesc: '您的登录状态已失效，请重新登录以继续。',
      later: '稍后',
      loginNow: '立即登录',
      footerCopyright: '© 2026 CodeMan Community. 为编程猫开发者而生。',
      switchLang: 'Language / 语言',
      search: '搜索',
      developer: '开放中心',
      admin: '站长',
      chat: '聊天室',
      githubDemo: 'GitHub 演示',
      whatsNew: '更新日志',
      gotIt: '知道了'
    },
    chat: {
      title: '聊天室',
      publicChat: '公共聊天室',
      contacts: '联系人',
      requests: '好友请求',
      noRequests: '暂无好友请求',
      sendMessage: '发送消息',
      typeMessage: '输入消息...',
      send: '发送',
      notFriends: '非好友',
      notFriendsDesc: '你需要先添加对方为好友才能发送私信。',
      sendRequest: '发送好友请求',
      accept: '接受',
      reject: '拒绝',
      live: '在线',
      online: '在线',
      offline: '离线',
      user: '用户',
      self: '自己'
    },
    forum: {
      categories: '分类',
      allPosts: '所有帖子',
      newPost: '发布新帖',
      searchPlaceholder: '搜索讨论...',
      discussions: '讨论列表',
      communityTab: '社区讨论',
      officialTab: '编程猫官方',
      noPosts: '该分类下暂无帖子。快来发布第一条吧！',
      noOfficialPosts: '该板块下暂无编程猫官方帖子。',
      postedBy: '发布者',
      loadMore: '加载更多',
      loadMoreOfficial: '加载更多官方帖',
      createTitle: '创建新帖子',
      titleLabel: '标题',
      categoryLabel: '分类',
      contentLabel: '内容',
      cancel: '取消',
      publish: '发布帖子',
      selectCategory: '选择分类',
      enterTitle: '请输入描述性标题',
      markdownSupported: '支持 Markdown 语法'
    },
    post: {
      backToForum: '返回论坛',
      author: '作者',
      postedOn: '发布于',
      category: '分类',
      replies: '回复',
      comments: '评论',
      noComments: '暂无评论。快来抢沙发！',
      writeComment: '写下你的评论...',
      postComment: '发表评论',
      posting: '正在发表...',
      loginToComment: '请登录后参与讨论。',
      officialLabel: '编程猫官方',
      specialLabel: 'CodeMan 专区',
      noOfficialReplies: '暂无官方回复。',
      noSpecialComments: '暂无专区评论。做第一个发言的人！',
      joinExclusive: '加入 CodeMan 专属讨论！',
      embedCode: '嵌入代码',
      copy: '复制',
      report: '举报',
      officialTag: '官方认证',
      top: '置顶',
      hot: '热门'
    }
  },
  en: {
    common: {
      home: 'Home',
      forum: 'Forum',
      showcase: 'Showcase',
      about: 'About Us',
      login: 'Log In',
      logout: 'Log Out',
      profile: 'My Profile',
      loading: 'Loading...',
      loadMore: 'Load More',
      noMore: 'No more data',
      views: 'Views',
      likes: 'Likes',
      download: 'Download',
      post: 'Post',
      joinDiscussion: 'Join Discussion',
      exploreProjects: 'Explore Projects',
      welcome: 'Welcome to CodeMan',
      welcomeDesc: 'The next-generation community for creative coders. Secure, fast, and open.',
      trending: 'Trending Now',
      hotDiscuss: 'Hot Discussions',
      hotWorks: 'Popular Works',
      recentDiscuss: 'Recent Discussions',
      viewForum: 'View Forum',
      featuredWorks: 'Featured Works',
      viewShowcase: 'View Showcase',
      noDiscussions: 'No discussions yet. Be the first to post!',
      slogan: 'Connecting Every Developer',
      mission: 'Building a better Codemao site. A secure, free, and open community for all Codemao users.',
      featureSource: 'Source Code Sharing',
      featureSourceDesc: 'Gathering high-quality Codemao project source codes to promote technical exchange and learning.',
      featureSafe: 'Safe Browsing',
      featureSafeDesc: 'Built-in Anti-XSS mechanism to filter malicious code, providing a clean environment for users of all ages.',
      featureApi: 'Open API',
      featureApiDesc: 'Providing secure and stable API interfaces for all Codemao users, empowering developers to create more.',
      team: 'Maintainer Team',
      maintainer: 'CodeMan Community is maintained by Skyworld.',
      devService: 'Developer Services',
      devServiceDesc: 'We provide Codemao Unified Login Platform integration, supporting iframe + SDK quick integration.',
      ack: 'Special Thanks',
      loginTitle: 'Account Login',
      loginSubtitle: 'Please continue with your Codemao account',
      usernameLabel: 'Username / Phone',
      passwordLabel: 'Password',
      usernamePlaceholder: 'Enter Codemao ID',
      passwordPlaceholder: 'Enter Password',
      submitLogin: 'Authorize & Login',
      loggingIn: 'Verifying...',
      forgotPassword: 'Forgot Password? Reset at Codemao Official Site',
      authTitle: 'Developer Authorization',
      authRequest: 'CodeMan Community requests access to your account info.',
      authScope: 'This will allow the app to access your public profile (nickname, avatar, bio, etc).',
      scopeProfile: 'Read Public Profile',
      scopePost: 'Publish Posts & Comments',
      sessionExpired: 'Session Expired',
      sessionExpiredDesc: 'Your login session has expired. Please log in again to continue.',
      later: 'Later',
      loginNow: 'Log In Now',
      footerCopyright: '© 2026 CodeMan Community. Built for Codemao Developers.',
      switchLang: 'Language / 语言',
      search: 'Search',
      developer: 'Developers',
      chat: 'Chat',
      githubDemo: 'GitHub Demo',
      whatsNew: 'What\'s New',
      gotIt: 'Got it!',
      follow: 'Follow',
      unfollow: 'Unfollow',
      noBio: 'No bio provided.'
    },
    chat: {
      title: 'Chat Room',
      publicChat: 'Public Chat',
      contacts: 'Contacts',
      requests: 'Requests',
      noRequests: 'No pending requests',
      sendMessage: 'Send Message',
      typeMessage: 'Type a message...',
      send: 'Send',
      notFriends: 'Not Friends',
      notFriendsDesc: 'You need to be friends with this user to send private messages.',
      sendRequest: 'Add Friend',
      accept: 'Accept',
      reject: 'Reject',
      live: 'Live',
      online: 'Online',
      offline: 'Offline',
      user: 'User',
      self: 'You'
    },
    forum: {
      categories: 'Categories',
      allPosts: 'All Posts',
      newPost: 'New Post',
      searchPlaceholder: 'Search discussions...',
      discussions: 'Discussions',
      communityTab: 'Community',
      officialTab: 'Codemao Official',
      noPosts: 'No posts found in this category. Be the first to start a discussion!',
      noOfficialPosts: 'No official posts found in this board.',
      postedBy: 'Posted by',
      loadMore: 'Load More',
      loadMoreOfficial: 'Load More Official Posts',
      createTitle: 'Create New Post',
      titleLabel: 'Title',
      categoryLabel: 'Category',
      contentLabel: 'Content',
      cancel: 'Cancel',
      publish: 'Publish Post',
      selectCategory: 'Select a category',
      enterTitle: 'Enter a descriptive title',
      markdownSupported: 'Markdown supported'
    },
    post: {
      backToForum: 'Back to Forum',
      author: 'Author',
      postedOn: 'Posted on',
      category: 'Category',
      replies: 'Replies',
      comments: 'Comments',
      noComments: 'No comments yet. Be the first to share your thoughts!',
      writeComment: 'Write a comment...',
      postComment: 'Post Comment',
      posting: 'Posting...',
      loginToComment: 'Please log in to join the discussion.',
      officialLabel: 'Codemao Official',
      specialLabel: 'CodeMan Special',
      noOfficialReplies: 'No official replies yet.',
      noSpecialComments: 'No special comments yet. Be the first!',
      joinExclusive: 'Join the exclusive CodeMan discussion!',
      embedCode: 'Embed Code',
      copy: 'Copy',
      report: 'Report',
      officialTag: 'Official',
      top: 'TOP',
      hot: 'HOT'
    }
  }
}

export function t(key) {
  const keys = key.split('.')
  let value = messages[i18nState.locale]
  for (const k of keys) {
    if (value && value[k]) {
      value = value[k]
    } else {
      return key // Fallback to key if not found
    }
  }
  return value
}

// Composable for use in components
export function useI18n() {
  return {
    t,
    locale: computed(() => i18nState.locale),
    setLocale
  }
}
